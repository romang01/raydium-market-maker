var dn=Object.defineProperty,gn=Object.defineProperties;var hn=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var Lt=(e,t,n)=>t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,z=(e,t)=>{for(var n in t||(t={}))Bt.call(t,n)&&Lt(e,n,t[n]);if(Me)for(var n of Me(t))Ct.call(t,n)&&Lt(e,n,t[n]);return e},oe=(e,t)=>gn(e,hn(t));var De=(e,t)=>{var n={};for(var r in e)Bt.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Me)for(var r of Me(e))t.indexOf(r)<0&&Ct.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Gr,Transaction as xt,TransactionInstruction as Hr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as jr}from"@solana/spl-token";import mn from"bn.js";import{PublicKey as wn}from"@solana/web3.js";import{get as kt,set as bn}from"lodash";var Xe=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Nt={},yn={};function Y(e){let t=kt(Nt,e);if(!t){let n=kt(yn,e);t=new Xe({name:e,logLevel:n}),bn(Nt,e,t)}return t}import{MINT_SIZE as ri,TOKEN_PROGRAM_ID as ii,getTransferFeeConfig as oi,unpackMint as si}from"@solana/spl-token";var $e=Y("Raydium_accountInfo_util");async function Re(e,t,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=z({batchRequest:!1},n),s=et(t,o),a=new Array(s.length).fill([]);if(r){let c=s.map(f=>{let m=e._buildArgs([f.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=et(c,10);a=(await(await Promise.all(u.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:d,executable:h,lamports:g,owner:b,rentEpoch:T}=m;return d.length!==2&&d[1]!=="base64"&&$e.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:h,lamports:g,owner:new wn(b),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,i)))}catch(c){c instanceof Error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}import ie from"bn.js";var pe=9e15,ce=1e9,nt="0123456789abcdef",_e="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Fe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-pe,maxE:pe,crypto:!1},Dt,ne,C=!0,Ke="[DecimalError] ",ue=Ke+"Invalid argument: ",Rt=Ke+"Precision limit exceeded",Ot=Ke+"crypto unavailable",_t="[object Decimal]",G=Math.floor,W=Math.pow,Tn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Pn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,xn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ft=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,X=1e7,L=7,An=9007199254740991,Sn=_e.length-1,it=Fe.length-1,p={toStringTag:_t};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),A(e)};p.ceil=function(){return A(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ue+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};p.comparedTo=p.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,c=o.s,u=e.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==e.e)return o.e>e.e^c<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^c<0?1:-1;return r===i?0:r>i^c<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+L,r.rounding=1,n=Ln(r,Ut(r,n)),r.precision=e,r.rounding=t,A(ne==2||ne==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,r,i,o,s,a,c,u,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(C=!1,o=l.s*W(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=W(n,1/3),e=G((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,c=a.times(a).times(a),u=c.plus(l),r=R(u.plus(l).times(a),u.plus(c),s+2,1),q(a.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(A(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(A(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return C=!0,A(r,e,f.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-G(this.e/L))*L,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return R(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return A(R(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return A(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/We(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=de(s,1,o.times(t),new s(1),!0);for(var c,u=e,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return A(o,s.precision=n,s.rounding=r,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=de(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/We(5,e)),i=de(o,2,i,i,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=t,o.rounding=n,A(i,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,R(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};p.inverseCosine=p.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Q(n,i,o):new n(0):new n(NaN):t.isZero()?Q(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Q(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,C=!1,n=n.times(n).minus(1).sqrt().plus(n),C=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,C=!1,n=n.times(n).plus(1).sqrt().plus(n),C=!0,r.precision=e,r.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?A(new o(i),e,t,!0):(o.precision=n=r-i.e,i=R(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Q(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&f+4<=it)return s=Q(l,f+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(f+4<=it)return s=Q(l,f+4,m).times(.5),s.s=u.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/L+2|0),e=n;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(C=!1,t=Math.ceil(a/L),r=1,c=u.times(u),s=new l(u),i=u;e!==-1;)if(i=i.times(c),o=s.minus(i.div(r+=2)),i=i.times(c),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),C=!0,A(s,l.precision=f,l.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&G(this.e/L)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,r,i,o,s,a,c,u=this,l=u.constructor,f=l.precision,m=l.rounding,d=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=u.d,u.s<0||!n||!n[0]||u.eq(1))return new l(n&&!n[0]?-1/0:u.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(C=!1,a=f+d,s=ae(u,a),r=t?ve(l,a+10):ae(e,a),c=R(s,r,a,1),we(c.d,i=f,m))do if(a+=10,s=ae(u,a),r=t?ve(l,a+10):ae(e,a),c=R(s,r,a,1),!o){+q(c.d).slice(i+1,i+15)+1==1e14&&(c=A(c,f+1,0));break}while(we(c.d,i+=10,m));return C=!0,A(c,f,m)};p.minus=p.sub=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,h=d.constructor;if(e=new h(e),!d.d||!e.d)return!d.s||!e.s?e=new h(NaN):d.d?e.s=-e.s:e=new h(e.d||d.s!==e.s?d:NaN),e;if(d.s!=e.s)return e.s=-e.s,d.plus(e);if(u=d.d,m=e.d,a=h.precision,c=h.rounding,!u[0]||!m[0]){if(m[0])e.s=-e.s;else if(u[0])e=new h(d);else return new h(c===3?-0:0);return C?A(e,a,c):e}if(n=G(e.e/L),l=G(d.e/L),u=u.slice(),o=l-n,o){for(f=o<0,f?(t=u,o=-o,s=m.length):(t=m,n=l,s=u.length),r=Math.max(Math.ceil(a/L),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=u.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(u[r]!=m[r]){f=u[r]<m[r];break}o=0}for(f&&(t=u,u=m,m=t,e.s=-e.s),s=u.length,r=m.length-s;r>0;--r)u[s++]=0;for(r=m.length;r>o;){if(u[--r]<m[r]){for(i=r;i&&u[--i]===0;)u[i]=X-1;--u[i],u[r]+=X}u[r]-=m[r]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--n;return u[0]?(e.d=u,e.e=Ve(u,n),C?A(e,a,c):e):new h(c===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?A(new r(n),r.precision,r.rounding):(C=!1,r.modulo==9?(t=R(n,e.abs(),0,3,1),t.s*=e.s):t=R(n,e,0,r.modulo,1),t=t.times(e),C=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return ot(this)};p.naturalLogarithm=p.ln=function(){return ae(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,A(e)};p.plus=p.add=function(e){var t,n,r,i,o,s,a,c,u,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,l=e.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(e=new m(f)),C?A(e,a,c):e;if(o=G(f.e/L),r=G(e.e/L),u=u.slice(),i=o-r,i){for(i<0?(n=u,i=-i,s=l.length):(n=l,r=o,s=u.length),o=Math.ceil(a/L),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=u.length,i=l.length,s-i<0&&(i=s,n=l,l=u,u=n),t=0;i;)t=(u[--i]=u[i]+l[i]+t)/X|0,u[i]%=X;for(t&&(u.unshift(t),++r),s=u.length;u[--s]==0;)u.pop();return e.d=u,e.e=Ve(u,r),C?A(e,a,c):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ue+e);return n.d?(t=vt(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return A(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+L,r.rounding=1,n=Cn(r,Ut(r,n)),r.precision=e,r.rounding=t,A(ne>2?n.neg():n,e,t,!0)):new r(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(C=!1,u=Math.sqrt(+s),u==0||u==1/0?(t=q(a),(t.length+c)%2==0&&(t+="0"),u=Math.sqrt(t),c=G((c+1)/2)-(c<0||c%2),u==1/0?t="5e"+c:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+c),r=new l(t)):r=new l(u.toString()),n=(c=l.precision)+3;;)if(o=r,r=o.plus(R(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(t=q(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(A(o,c+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(r,c+1,1),e=!r.times(r).eq(s));break}return C=!0,A(r,c,l.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=R(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,A(ne==2||ne==4?n.neg():n,e,t,!0)):new r(NaN)};p.times=p.mul=function(e){var t,n,r,i,o,s,a,c,u,l=this,f=l.constructor,m=l.d,d=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!e.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?e.s/0:e.s*0);for(n=G(l.e/L)+G(e.e/L),c=m.length,u=d.length,c<u&&(o=m,m=d,d=o,s=c,c=u,u=s),o=[],s=c+u,r=s;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,i=c+r;i>r;)a=o[i]+d[r]*m[i-r-1]+t,o[i--]=a%X|0,t=a/X|0;o[i]=(o[i]+t)%X|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=Ve(o,n),C?A(e,f.precision,f.rounding):e};p.toBinary=function(e,t){return at(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(Z(e,0,ce),t===void 0?t=r.rounding:Z(t,0,8),A(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=$(r,!0):(Z(e,0,ce),t===void 0?t=i.rounding:Z(t,0,8),r=A(new i(r),e+1,t),n=$(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=$(i):(Z(e,0,ce),t===void 0?t=o.rounding:Z(t,0,8),r=A(new o(i),e+i.e+1,t),n=$(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,r,i,o,s,a,c,u,l,f,m,d=this,h=d.d,g=d.constructor;if(!h)return new g(d);if(u=n=new g(1),r=c=new g(0),t=new g(r),o=t.e=vt(h)-d.e-1,s=o%L,t.d[0]=W(10,s<0?L+s:s),e==null)e=o>0?t:u;else{if(a=new g(e),!a.isInt()||a.lt(u))throw Error(ue+a);e=a.gt(t)?o>0?t:u:a}for(C=!1,a=new g(q(h)),l=g.precision,g.precision=o=h.length*L*2;f=R(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=u,u=c.plus(f.times(i)),c=i,i=t,t=a.minus(f.times(i)),a=i;return i=R(e.minus(n),r,0,1,1),c=c.plus(i.times(u)),n=n.plus(i.times(r)),c.s=u.s=d.s,m=R(u,r,o,1).minus(d).abs().cmp(R(c,n,o,1).minus(d).abs())<1?[u,r]:[c,n],g.precision=l,C=!0,m};p.toHexadecimal=p.toHex=function(e,t){return at(this,16,e,t)};p.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:Z(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(C=!1,n=R(n,e,0,t,1).times(e),C=!0,A(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return at(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,r,i,o,s,a=this,c=a.constructor,u=+(e=new c(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new c(W(+a,u));if(a=new c(a),a.eq(1))return a;if(r=c.precision,o=c.rounding,e.eq(1))return A(a,r,o);if(t=G(e.e/L),t>=e.d.length-1&&(n=u<0?-u:u)<=An)return i=Kt(c,a,n,r),e.s<0?new c(1).div(i):A(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new c(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=W(+a,u),t=n==0||!isFinite(n)?G(u*(Math.log("0."+q(a.d))/Math.LN10+a.e+1)):new c(n+"").e,t>c.maxE+1||t<c.minE-1?new c(t>0?s/0:0):(C=!1,c.rounding=a.s=1,n=Math.min(12,(t+"").length),i=ot(e.times(ae(a,r+n)),r),i.d&&(i=A(i,r+5,1),we(i.d,r,o)&&(t=r+10,i=A(ot(e.times(ae(a,t+n)),t),t+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=A(i,r+1,0)))),i.s=s,C=!0,c.rounding=o,A(i,r,o))};p.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=$(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(Z(e,1,ce),t===void 0?t=i.rounding:Z(t,0,8),r=A(new i(r),e,t),n=$(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(Z(e,1,ce),t===void 0?t=r.rounding:Z(t,0,8)),A(new r(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return A(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=$(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function q(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=L-r.length,n&&(o+=se(n)),o+=r;s=e[t],r=s+"",n=L-r.length,n&&(o+=se(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Z(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ue+e)}function we(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=L,i=0):(i=Math.ceil((t+1)/L),t%=L),o=W(10,L-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==W(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==W(10,t-3)-1,s}function Oe(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=nt.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function Ln(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/We(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=de(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var R=function(){function e(r,i,o){var s,a=0,c=r.length;for(r=r.slice();c--;)s=r[c]*i+a,r[c]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(r[a]!=i[a]){c=r[a]>i[a]?1:-1;break}return c}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,c){var u,l,f,m,d,h,g,b,T,x,w,y,S,P,N,B,D,j,O,v,V=r.constructor,U=r.s==i.s?1:-1,K=r.d,M=i.d;if(!K||!K[0]||!M||!M[0])return new V(!r.s||!i.s||(K?M&&K[0]==M[0]:!M)?NaN:K&&K[0]==0||!M?U*0:U/0);for(c?(d=1,l=r.e-i.e):(c=X,d=L,l=G(r.e/d)-G(i.e/d)),O=M.length,D=K.length,T=new V(U),x=T.d=[],f=0;M[f]==(K[f]||0);f++);if(M[f]>(K[f]||0)&&l--,o==null?(P=o=V.precision,s=V.rounding):a?P=o+(r.e-i.e)+1:P=o,P<0)x.push(1),h=!0;else{if(P=P/d+2|0,f=0,O==1){for(m=0,M=M[0],P++;(f<D||m)&&P--;f++)N=m*c+(K[f]||0),x[f]=N/M|0,m=N%M|0;h=m||f<D}else{for(m=c/(M[0]+1)|0,m>1&&(M=e(M,m,c),K=e(K,m,c),O=M.length,D=K.length),B=O,w=K.slice(0,O),y=w.length;y<O;)w[y++]=0;v=M.slice(),v.unshift(0),j=M[0],M[1]>=c/2&&++j;do m=0,u=t(M,w,O,y),u<0?(S=w[0],O!=y&&(S=S*c+(w[1]||0)),m=S/j|0,m>1?(m>=c&&(m=c-1),g=e(M,m,c),b=g.length,y=w.length,u=t(g,w,b,y),u==1&&(m--,n(g,O<b?v:M,b,c))):(m==0&&(u=m=1),g=M.slice()),b=g.length,b<y&&g.unshift(0),n(w,g,y,c),u==-1&&(y=w.length,u=t(M,w,O,y),u<1&&(m++,n(w,O<y?v:M,y,c))),y=w.length):u===0&&(m++,w=[0]),x[f++]=m,u&&w[0]?w[y++]=K[B]||0:(w=[K[B]],y=1);while((B++<D||w[0]!==void 0)&&P--);h=w[0]!==void 0}x[0]||x.shift()}if(d==1)T.e=l,Dt=h;else{for(f=1,m=x[0];m>=10;m/=10)f++;T.e=f+l*d-1,A(T,a?o+T.e+1:o,s,h)}return T}}();function A(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=L,s=t,l=f[m=0],c=l/W(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/L),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=c=0,i=1,o%=L,s=o-L+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=L,s=o-L+i,c=s<0?0:l/W(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%W(10,i-s-1)),u=n<4?(c||r)&&(n==0||n==(e.s<0?3:2)):c>5||c==5&&(n==4||r||n==6&&(o>0?s>0?l/W(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=W(10,(L-t%L)%L),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=W(10,L-o),f[m]=s>0?(l/W(10,i-s)%W(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==X&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=X)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return C&&(e.e>d.maxE?(e.d=null,e.e=NaN):e.e<d.minE&&(e.e=0,e.d=[0])),e}function $(e,t,n){if(!e.isFinite())return Wt(e);var r,i=e.e,o=q(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+se(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+se(-i-1)+o,n&&(r=n-s)>0&&(o+=se(r))):i>=s?(o+=se(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+se(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=se(r))),o}function Ve(e,t){var n=e[0];for(t*=L;n>=10;n/=10)t++;return t}function ve(e,t,n){if(t>Sn)throw C=!0,n&&(e.precision=n),Error(Rt);return A(new e(_e),t,1,!0)}function Q(e,t,n){if(t>it)throw Error(Rt);return A(new e(Fe),t,n,!0)}function vt(e){var t=e.length-1,n=t*L+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function se(e){for(var t="";e--;)t+="0";return t}function Kt(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/L+4);for(C=!1;;){if(n%2&&(o=o.times(t),Et(o.d,s)&&(i=!0)),n=G(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Et(t.d,s)}return C=!0,o}function It(e){return e.d[e.d.length-1]&1}function Vt(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function ot(e,t){var n,r,i,o,s,a,c,u=0,l=0,f=0,m=e.constructor,d=m.rounding,h=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(C=!1,c=h):c=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(W(2,f))/Math.LN10*2+5|0,c+=r,n=o=s=new m(1),m.precision=c;;){if(o=A(o.times(e),c,1),n=n.times(++l),a=s.plus(R(o,n,c,1)),q(a.d).slice(0,c)===q(s.d).slice(0,c)){for(i=f;i--;)s=A(s.times(s),c,1);if(t==null)if(u<3&&we(s.d,c-r,d,u))m.precision=c+=10,n=o=a=new m(1),l=0,u++;else return A(s,m.precision=h,d,C=!0);else return m.precision=h,s}s=a}}function ae(e,t){var n,r,i,o,s,a,c,u,l,f,m,d=1,h=10,g=e,b=g.d,T=g.constructor,x=T.rounding,w=T.precision;if(g.s<0||!b||!b[0]||!g.e&&b[0]==1&&b.length==1)return new T(b&&!b[0]?-1/0:g.s!=1?NaN:b?0:g);if(t==null?(C=!1,l=w):l=t,T.precision=l+=h,n=q(b),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=q(g.d),r=n.charAt(0),d++;o=g.e,r>1?(g=new T("0."+n),o++):g=new T(r+"."+n.slice(1))}else return u=ve(T,l+2,w).times(o+""),g=ae(new T(r+"."+n.slice(1)),l-h).plus(u),T.precision=w,t==null?A(g,w,x,C=!0):g;for(f=g,c=s=g=R(g.minus(1),g.plus(1),l,1),m=A(g.times(g),l,1),i=3;;){if(s=A(s.times(m),l,1),u=c.plus(R(s,new T(i),l,1)),q(u.d).slice(0,l)===q(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(ve(T,l+2,w).times(o+""))),c=R(c,new T(d),l,1),t==null)if(we(c.d,l-h,x,a))T.precision=l+=h,u=s=g=R(f.minus(1),f.plus(1),l,1),m=A(g.times(g),l,1),i=a=1;else return A(c,T.precision=w,x,C=!0);else return T.precision=w,c;c=u,i+=2}}function Wt(e){return String(e.s*e.s/0)}function st(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%L,n<0&&(r+=L),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=L;r<i;)e.d.push(+t.slice(r,r+=L));t=t.slice(r),r=L-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),C&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Bn(e,t){var n,r,i,o,s,a,c,u,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Ft.test(t))return st(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Pn.test(t))n=16,t=t.toLowerCase();else if(Tn.test(t))n=2;else if(xn.test(t))n=8;else throw Error(ue+t);for(o=t.search(/p/i),o>0?(c=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=Kt(r,new r(n),o,o*2)),u=Oe(t,n,X),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new r(e.s*0):(e.e=Ve(u,l),e.d=u,C=!1,s&&(e=R(e,i,a*4)),c&&(e=e.times(Math.abs(c)<54?W(2,c):Ue.pow(2,c))),C=!0,e)}function Cn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:de(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/We(5,n)),t=de(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function de(e,t,n,r,i){var o,s,a,c,u=1,l=e.precision,f=Math.ceil(l/L);for(C=!1,c=n.times(n),a=new e(r);;){if(s=R(a.times(c),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=R(s.times(c),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,u++}return C=!0,s.d.length=f+1,s}function We(e,t){for(var n=e;--t;)n*=e;return n}function Ut(e,t){var n,r=t.s<0,i=Q(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return ne=r?4:1,t;if(n=t.divToInt(i),n.isZero())ne=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return ne=It(n)?r?2:3:r?4:1,t;ne=It(n)?r?1:4:r?3:2}return t.minus(i).abs()}function at(e,t,n,r){var i,o,s,a,c,u,l,f,m,d=e.constructor,h=n!==void 0;if(h?(Z(n,1,ce),r===void 0?r=d.rounding:Z(r,0,8)):(n=d.precision,r=d.rounding),!e.isFinite())l=Wt(e);else{for(l=$(e),s=l.indexOf("."),h?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=Oe($(m),10,i),m.e=m.d.length),f=Oe(l,10,i),o=c=f.length;f[--c]==0;)f.pop();if(!f[0])l=h?"0p+0":"0";else{if(s<0?o--:(e=new d(e),e.d=f,e.e=o,e=R(e,m,n,r,0,i),f=e.d,o=e.e,u=Dt),s=f[n],a=i/2,u=u||f[n+1]!==void 0,u=r<4?(s!==void 0||u)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||u||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,u)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(c=f.length;!f[c-1];--c);for(s=0,l="";s<c;s++)l+=nt.charAt(f[s]);if(h){if(c>1)if(t==16||t==8){for(s=t==16?4:3,--c;c%s;c++)l+="0";for(f=Oe(l,i,t),c=f.length;!f[c-1];--c);for(s=1,l="1.";s<c;s++)l+=nt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Et(e,t){if(e.length>t)return e.length=t,!0}function kn(e){return new this(e).abs()}function Nn(e){return new this(e).acos()}function In(e){return new this(e).acosh()}function En(e,t){return new this(e).plus(t)}function Mn(e){return new this(e).asin()}function Dn(e){return new this(e).asinh()}function Rn(e){return new this(e).atan()}function On(e){return new this(e).atanh()}function _n(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Q(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Q(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Q(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(R(e,t,o,1)),t=Q(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(R(e,t,o,1)),n}function Fn(e){return new this(e).cbrt()}function vn(e){return A(e=new this(e),e.e+1,2)}function Kn(e,t,n){return new this(e).clamp(t,n)}function Vn(e){if(!e||typeof e!="object")throw Error(Ke+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,ce,"rounding",0,8,"toExpNeg",-pe,0,"toExpPos",0,pe,"maxE",0,pe,"minE",-pe,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=rt[n]),(r=e[n])!==void 0)if(G(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(ue+n+": "+r);if(n="crypto",i&&(this[n]=rt[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Ot);else this[n]=!1;else throw Error(ue+n+": "+r);return this}function Wn(e){return new this(e).cos()}function Un(e){return new this(e).cosh()}function qt(e){var t,n,r;function i(o){var s,a,c,u=this;if(!(u instanceof i))return new i(o);if(u.constructor=i,Mt(o)){u.s=o.s,C?!o.d||o.e>i.maxE?(u.e=NaN,u.d=null):o.e<i.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;C?s>i.maxE?(u.e=NaN,u.d=null):s<i.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return st(u,o.toString())}else if(c!=="string")throw Error(ue+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Ft.test(o)?st(u,o):Bn(u,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Vn,i.clone=qt,i.isDecimal=Mt,i.abs=kn,i.acos=Nn,i.acosh=In,i.add=En,i.asin=Mn,i.asinh=Dn,i.atan=Rn,i.atanh=On,i.atan2=_n,i.cbrt=Fn,i.ceil=vn,i.clamp=Kn,i.cos=Wn,i.cosh=Un,i.div=qn,i.exp=Gn,i.floor=Hn,i.hypot=jn,i.ln=zn,i.log=Yn,i.log10=Jn,i.log2=Zn,i.max=Qn,i.min=Xn,i.mod=$n,i.mul=er,i.pow=tr,i.random=nr,i.round=rr,i.sign=ir,i.sin=or,i.sinh=sr,i.sqrt=ar,i.sub=ur,i.sum=cr,i.tan=lr,i.tanh=fr,i.trunc=mr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function qn(e,t){return new this(e).div(t)}function Gn(e){return new this(e).exp()}function Hn(e){return A(e=new this(e),e.e+1,3)}function jn(){var e,t,n=new this(0);for(C=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return C=!0,new this(1/0);n=t}return C=!0,n.sqrt()}function Mt(e){return e instanceof Ue||e&&e.toStringTag===_t||!1}function zn(e){return new this(e).ln()}function Yn(e,t){return new this(e).log(t)}function Zn(e){return new this(e).log(2)}function Jn(e){return new this(e).log(10)}function Qn(){return Vt(this,arguments,"lt")}function Xn(){return Vt(this,arguments,"gt")}function $n(e,t){return new this(e).mod(t)}function er(e,t){return new this(e).mul(t)}function tr(e,t){return new this(e).pow(t)}function nr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:Z(e,1,ce),r=Math.ceil(e/L),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Ot);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=L,r&&e&&(i=W(10,L-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=L)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<L&&(n-=L-r)}return s.e=n,s.d=a,s}function rr(e){return A(e=new this(e),e.e+1,this.rounding)}function ir(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function or(e){return new this(e).sin()}function sr(e){return new this(e).sinh()}function ar(e){return new this(e).sqrt()}function ur(e,t){return new this(e).sub(t)}function cr(){var e=0,t=arguments,n=new this(t[e]);for(C=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return C=!0,A(n,this.precision,this.rounding)}function lr(e){return new this(e).tan()}function fr(e){return new this(e).tanh()}function mr(e){return A(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var Ue=p.constructor=qt(rt);_e=new Ue(_e);Fe=new Ue(Fe);import Tr from"big.js";import Li from"bn.js";import pr from"toformat";var dr=pr,Te=dr;import Ge from"big.js";import hr from"bn.js";import br from"decimal.js-light";import Pe from"bn.js";var Gt=9007199254740991;function re(e){let t=Y("Raydium_parseBigNumberish");if(e instanceof Pe)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Pe(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Gt||e<=-Gt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Pe(String(e))):typeof e=="bigint"?new Pe(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Pe(0))}var qe=Y("module/fraction"),ut=Te(Ge),xe=Te(br),yr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},wr={[0]:Ge.roundDown,[1]:Ge.roundHalfUp,[2]:Ge.roundUp},_=class{constructor(t,n=new hr(1)){this.numerator=re(t),this.denominator=re(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(t){let n=t instanceof _?t:new _(re(t));return this.denominator.eq(n.denominator)?new _(this.numerator.add(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof _?t:new _(re(t));return this.denominator.eq(n.denominator)?new _(this.numerator.sub(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof _?t:new _(re(t));return new _(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof _?t:new _(re(t));return new _(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||qe.logWithError(`${t} is not an integer.`),t<=0&&qe.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:yr[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||qe.logWithError(`${t} is not an integer.`),t<0&&qe.logWithError(`${t} is negative.`),ut.DP=t,ut.RM=wr[r]||1,new ut(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var Ri=Y("Raydium_amount"),Oi=Te(Tr);import{PublicKey as xr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ht}from"@solana/spl-token";var jt={chainId:101,address:xr.default.toBase58(),programId:Ht.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Ht.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as lt}from"@solana/web3.js";import{PublicKey as F,SystemProgram as zt,SYSVAR_RENT_PUBKEY as Ar}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Sr}from"@solana/spl-token";function ct({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var qi=[ct({pubkey:Sr,isWritable:!1}),ct({pubkey:zt.programId,isWritable:!1}),ct({pubkey:Ar,isWritable:!1})];function Yt({publicKey:e,transformSol:t}){let n=Zt(e.toString());if(n instanceof F)return t&&n.equals(Ae)?tt:n;if(t&&n.toString()===Ae.toBase58())return tt;if(typeof n=="string"){if(n===F.default.toBase58())return F.default;try{return new F(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Zt(e){try{return new F(e)}catch{return e}}var Gi=new F("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Hi=new F("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ji=new F("SysvarRent111111111111111111111111111111111"),zi=new F("SysvarC1ock11111111111111111111111111111111"),Yi=new F("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Zi=new F("Sysvar1nstructions1111111111111111111111111"),Ji=zt.programId,Qi=new F("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Xi=new F("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),$i=new F("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),eo=new F("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),to=new F("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),no=new F("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ro=new F("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),io=new F("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),oo=new F("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),so=new F("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),ao=new F("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),tt=new F("So11111111111111111111111111111111111111112"),Ae=F.default;var ft=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Ae.toBase58()||t instanceof lt&&Ae.equals(t)){this.decimals=le.decimals,this.symbol=le.symbol,this.name=le.name,this.mint=new lt(le.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?lt.default:Yt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},J=ft;J.WSOL=new ft(oe(z({},le),{mint:le.address}));var mt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},He=mt;He.SOL=new mt(jt);import Lr from"bn.js";var To=new _(new Lr(100));var Bo=Y("Raydium_price");import{PublicKey as qo}from"@solana/web3.js";import Ho from"bn.js";var Br=new ie(0),ls=new ie(1),fs=new ie(2),ms=new ie(3),ps=new ie(5),Pr=new ie(10),ds=new ie(100),gs=new ie(1e3),hs=new ie(1e4);function et(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as Ds}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Os}from"@solana/spl-token";import{ComputeBudgetProgram as $t,Keypair as tn,PublicKey as Cr,Transaction as nn,TransactionMessage as kr,VersionedTransaction as rn}from"@solana/web3.js";var pt={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Nr}from"@solana/spl-token";var en=Y("Raydium_txUtil"),on=1644;function je(e){let t=[],n=[];return e.microLamports&&(t.push($t.setComputeUnitPrice({microLamports:e.microLamports})),n.push(pt.SetComputeUnitPrice)),e.units&&(t.push($t.setComputeUnitLimit({units:e.units})),n.push(pt.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ge(e,t){var r,i;let n=t!=null?t:"confirmed";return(i=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:i.blockhash}async function ze(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let i=setTimeout(r,6e4);e.onSignature(t,o=>{if(clearTimeout(i),!o.err){n("");return}r(o.err.toString())},"confirmed")})}function dt(e,t){e.length<1&&en.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&en.logWithError(`no signers provided:, ${t.toString()}`);let n=new nn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<on}catch{return!1}}function Ye(e,t){let[n,r]=Cr.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function Se({instructions:e,payer:t,signers:n}){return dt(e,[t,...n])}function Le({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=tn.generate().publicKey.toString()}){let o=new kr({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new rn(o).serialize()).toString("base64").length<on}catch{return!1}}var Ir=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),Er=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof rn&&(t=Ir(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function fe(e){let t=[];return e.forEach(n=>{n instanceof nn&&(n.recentBlockhash||(n.recentBlockhash=Nr.toBase58()),n.feePayer||(n.feePayer=tn.generate().publicKey)),t.push(Er(n))}),console.log("simulate tx string:",t),t}import{PublicKey as k}from"@solana/web3.js";var Ks=new k("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Vs=new k("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ws=new k("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Us=new k("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),qs=new k("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Gs=new k("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Hs=new k("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),js=new k("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),zs=new k("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Ys=new k("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Zs=new k("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Js=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Qs=new k("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Xs=new k("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$s=new k("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),ea=new k("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),ta=new k("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),na=new k("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ra=new k("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ia=new k("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),oa=new k("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),sa=new k("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Mr=new k("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Dr=new k("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Rr=new k("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),aa=new k("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Or=new k("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),ua=new k("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),_r=new k("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var ca={SERUM_MARKET:k.default,OPENBOOK_MARKET:new k("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:k.default,FarmV3:new k("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new k("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new k("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new k("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new k("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new k("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new k("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new k("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new k("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Mr,CREATE_CPMM_POOL_AUTH:Dr,CREATE_CPMM_POOL_FEE_ACC:Rr,FEE_DESTINATION_ID:new k("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Or,LCOK_CPMM_AUTH:_r};import ma from"bn.js";import{PublicKey as sn,AddressLookupTableAccount as Ze}from"@solana/web3.js";async function gt({connection:e,address:t}){let n=await Re(e,[...new Set(t.map(i=>i.toString()))].map(i=>new sn(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new Ze({key:s,state:Ze.deserialize(o.data)});r[s.toString()]=a,Je[s.toString()]=a}return r}var Je={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Ze({key:new sn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Ze.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Be,sendAndConfirmTransaction as ht,Transaction as Ce,TransactionMessage as ke,VersionedTransaction as Ne}from"@solana/web3.js";import Fr from"axios";var Qe=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Fr.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=je(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Be.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(z({},n||{})):this.build(n)}build(t){var r;let n=new Ce;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},c=o!=null?o:await ge(this.connection,this.blockhashCommitment);if(n.recentBlockhash=c,this.signers.length&&n.sign(...this.signers),fe([n]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await ht(this.connection,n,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let l=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var u;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var T;let{sequentially:f,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:h,skipPreflight:g=!0}=l||{},b=h!=null?h:await ge(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(f){let x=[],w=0;for(let y of s){if(++w,w<=d)continue;let S=await ht(this.connection,y,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});x.push(S)}return{txIds:x,signedTxs:s}}return{txIds:await await Promise.all(s.map(async x=>(x.recentBlockhash=b,await this.connection.sendRawTransaction(x.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let x=s.map((y,S)=>(y.recentBlockhash=b,a[S].length&&y.sign(...a[S]),y));fe(x);let w=await this.signAllTransactions(x);if(f){let y=0,S=[],P=async()=>{if(!w[y])return;let N=await this.connection.sendRawTransaction(w[y].serialize(),{skipPreflight:g});S.push({txId:N,status:"sent",signedTx:w[y]}),m==null||m([...S]),y++,this.connection.onSignature(N,B=>{let D=S.findIndex(j=>j.txId===N);D>-1&&(S[D].status=B.err?"error":"success"),m==null||m([...S]),B.err||P()},"processed"),this.connection.getSignatureStatus(N)};return await P(),{txIds:S.map(N=>N.txId),signedTxs:w}}else{let y=[];for(let S=0;S<w.length;S+=1){let P=await this.connection.sendRawTransaction(w[S].serialize(),{skipPreflight:g});y.push(P)}return{txIds:y,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let h=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=h,s=De(h,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=z(z({},this.cluster==="devnet"?{}:Je),n),c=Array.from(new Set([...r,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Be(b));let l=await gt({connection:this.connection,address:u});for(let[b,T]of Object.entries(l))a[b]=T;let f=i?Be.default.toBase58():o!=null?o:await ge(this.connection,this.blockhashCommitment),m=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ne(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var w;let{skipPreflight:T=!0,sendAndConfirm:x}=b||{};if(fe([d]),(w=this.owner)!=null&&w.isKeyPair){let y=await this.connection.sendTransaction(d,{skipPreflight:T});return x&&await ze(this.connection,y),{txId:y,signedTx:d}}if(this.signAllTransactions){let y=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(y[0],{skipPreflight:T}),signedTx:y[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var u;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:m,recentBlockHash:d,skipPreflight:h=!0}=l||{};if(d&&s.forEach(b=>b.message.recentBlockhash=d),fe(s),(g=this.owner)!=null&&g.isKeyPair){if(f){let b=[];for(let T of s){let x=await this.connection.sendTransaction(T,{skipPreflight:h});await ze(this.connection,x),b.push(x)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:h}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(f){let T=0,x=[],w=async()=>{if(!b[T])return;let y=await this.connection.sendTransaction(b[T],{skipPreflight:h});x.push({txId:y,status:"sent",signedTx:b[T]}),m==null||m([...x]),T++,this.connection.onSignature(y,S=>{let P=x.findIndex(N=>N.txId===y);P>-1&&(x[P].status=S.err?"error":"success"),m==null||m([...x]),S.err||w()},"processed"),this.connection.getSignatureStatus(y)};return w(),{txIds:[],signedTxs:b}}else{let T=[];for(let x=0;x<b.length;x+=1){let w=await this.connection.sendTransaction(b[x],{skipPreflight:h});T.push(w)}return{txIds:T,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var m;let f=t||{},{splitIns:n=[],computeBudgetConfig:r}=f,i=De(f,["splitIns","computeBudgetConfig"]),o=r?je(r):{instructions:[],instructionTypes:[]},s=this.signers.reduce((d,h)=>oe(z({},d),{[h.publicKey.toBase58()]:h}),{}),a=[],c=[],u=[],l=0;if(this.allInstructions.forEach(d=>{let h=[...u,d],g=r?[...o.instructions,...h]:h,T=[...new Set(h.map(x=>x.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat()).values()].map(x=>new Be(x));if(d!==n[l]&&u.length<12&&(Se({instructions:g,payer:this.feePayer,signers:T})||Se({instructions:h,payer:this.feePayer,signers:T})))u.push(d);else{if(u.length===0)throw Error("item ins too big");l+=d===n[l]?1:0,Se({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:T})?a.push(new Ce().add(...o.instructions,...u)):a.push(new Ce().add(...u)),c.push(Array.from(new Set(u.map(x=>x.keys.filter(w=>w.isSigner).map(w=>w.pubkey.toString())).flat())).map(x=>s[x]).filter(x=>x!==void 0)),u=[d]}}),u.length>0){let h=[...new Set(u.map(g=>g.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(g=>s[g]).filter(g=>g!==void 0);Se({instructions:r?[...o.instructions,...u]:[...u],payer:this.feePayer,signers:h.map(g=>g.publicKey)})?a.push(new Ce().add(...o.instructions,...u)):a.push(new Ce().add(...u)),c.push(h)}return a.forEach(d=>d.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&c.forEach(d=>{d.some(h=>h.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:a,signers:c,instructionTypes:this.instructionTypes,execute:async d=>{var y;let{sequentially:h,onTxUpdate:g,skipTxCount:b=0,recentBlockHash:T,skipPreflight:x=!0}=d||{},w=T!=null?T:await ge(this.connection,this.blockhashCommitment);if(a.forEach(async(S,P)=>{S.recentBlockhash=w,c[P].length&&S.sign(...c[P])}),fe(a),(y=this.owner)!=null&&y.isKeyPair){if(h){let S=0,P=[];for(let N of a){if(++S,S<=b){P.push("tx skipped");continue}let B=await ht(this.connection,N,this.signers.find(D=>D.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:x});P.push(B)}return{txIds:P,signedTxs:a}}return{txIds:await Promise.all(a.map(async S=>await this.connection.sendRawTransaction(S.serialize(),{skipPreflight:x}))),signedTxs:a}}if(this.signAllTransactions){let S=await this.signAllTransactions(a.slice(b,a.length)),P=[...a.slice(0,b),...S];if(h){let N=0,B=[],D=async()=>{if(!P[N])return;N<b&&(B.push({txId:"",status:"success",signedTx:P[N]}),g==null||g([...B]),N++,D());let j=await this.connection.sendRawTransaction(P[N].serialize(),{skipPreflight:x});B.push({txId:j,status:"sent",signedTx:P[N]}),g==null||g([...B]),N++,this.connection.onSignature(j,O=>{let v=B.findIndex(V=>V.txId===j);v>-1&&(B[v].status=O.err?"error":"success"),g==null||g([...B]),O.err||D()},"processed"),this.connection.getSignatureStatus(j)};return await D(),{txIds:B.map(j=>j.txId),signedTxs:P}}else{let N=[];for(let B=0;B<P.length;B+=1){let D=await this.connection.sendRawTransaction(P[B].serialize(),{skipPreflight:x});N.push(D)}return{txIds:N,signedTxs:P}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(t){var w;let x=t||{},{computeBudgetConfig:n,splitIns:r=[],lookupTableCache:i={},lookupTableAddress:o=[]}=x,s=De(x,["computeBudgetConfig","splitIns","lookupTableCache","lookupTableAddress"]),a=z(z({},this.cluster==="devnet"?{}:Je),i),c=Array.from(new Set([...this.lookupTableAddress,...o])),u=[];for(let y of c)a[y]===void 0&&u.push(new Be(y));let l=await gt({connection:this.connection,address:u});for(let[y,S]of Object.entries(l))a[y]=S;let f=n?je(n):{instructions:[],instructionTypes:[]},m=await ge(this.connection,this.blockhashCommitment),d=this.signers.reduce((y,S)=>oe(z({},y),{[S.publicKey.toBase58()]:S}),{}),h=[],g=[],b=[],T=0;if(this.allInstructions.forEach(y=>{let S=[...b,y],P=n?[...f.instructions,...S]:S;if(y!==r[T]&&b.length<12&&(Le({instructions:P,payer:this.feePayer,lookupTableAddressAccount:a})||Le({instructions:S,payer:this.feePayer,lookupTableAddressAccount:a})))b.push(y);else{if(b.length===0)throw Error("item ins too big");T+=y===r[T]?1:0;let N={};for(let B of[...new Set(c)])a[B]!==void 0&&(N[B]=a[B]);if(n&&Le({instructions:[...f.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let B=new ke({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...b]}).compileToV0Message(Object.values(a));h.push(new Ne(B))}else{let B=new ke({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));h.push(new Ne(B))}g.push(Array.from(new Set(b.map(B=>B.keys.filter(D=>D.isSigner).map(D=>D.pubkey.toString())).flat())).map(B=>d[B]).filter(B=>B!==void 0)),b=[y]}}),b.length>0){let S=[...new Set(b.map(P=>P.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat()).values()].map(P=>d[P]).filter(P=>P!==void 0);if(n&&Le({instructions:[...f.instructions,...b],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:m})){let P=new ke({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f.instructions,...b]}).compileToV0Message(Object.values(a));h.push(new Ne(P))}else{let P=new ke({payerKey:this.feePayer,recentBlockhash:m,instructions:[...b]}).compileToV0Message(Object.values(a));h.push(new Ne(P))}g.push(S)}return(w=this.owner)!=null&&w.signer&&g.forEach(y=>{y.some(S=>S.publicKey.equals(this.owner.publicKey))||y.push(this.owner.signer)}),{builder:this,transactions:h,buildProps:t,signers:g,instructionTypes:this.instructionTypes,execute:async y=>{var j;let{sequentially:S,onTxUpdate:P,skipTxCount:N=0,recentBlockHash:B,skipPreflight:D=!0}=y||{};if(h.map(async(O,v)=>{g[v].length&&O.sign(g[v]),B&&(O.message.recentBlockhash=B)}),fe(h),(j=this.owner)!=null&&j.isKeyPair){if(S){let O=0,v=[];for(let V of h){if(++O,O<=N){console.log("skip tx: ",O),v.push("tx skipped");continue}let U=await this.connection.sendTransaction(V,{skipPreflight:D});await ze(this.connection,U),v.push(U)}return{txIds:v,signedTxs:h}}return{txIds:await Promise.all(h.map(async O=>await this.connection.sendTransaction(O,{skipPreflight:D}))),signedTxs:h}}if(this.signAllTransactions){let O=await this.signAllTransactions(h.slice(N,h.length)),v=[...h.slice(0,N),...O];if(S){let V=0,U=[],K=async()=>{if(!v[V])return;if(V<N){U.push({txId:"",status:"success",signedTx:v[V]}),P==null||P([...U]),V++,K();return}let M=await this.connection.sendTransaction(v[V],{skipPreflight:D});U.push({txId:M,status:"sent",signedTx:v[V]}),P==null||P([...U]),V++,this.connection.onSignature(M,At=>{let St=U.findIndex(pn=>pn.txId===M);St>-1&&(U[St].status=At.err?"error":"success"),P==null||P([...U]),At.err||K()},"processed"),this.connection.getSignatureStatus(M)};return K(),{txIds:[],signedTxs:v}}else{let V=[];for(let U=0;U<v.length;U+=1){let K=await this.connection.sendTransaction(v[U],{skipPreflight:D});V.push(K)}return{txIds:V,signedTxs:v}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}};import{PublicKey as qr}from"@solana/web3.js";import ln,{isBN as fn}from"bn.js";import{bits as Za,BitStructure as Ja,blob as vr,Blob as Qa,cstr as Xa,f32 as $a,f32be as eu,f64 as tu,f64be as nu,greedy as ru,Layout as Kr,ns64 as iu,ns64be as ou,nu64 as su,nu64be as au,offset as uu,s16 as cu,s16be as lu,s24 as fu,s24be as mu,s32 as pu,s32be as du,s40 as gu,s40be as hu,s48 as bu,s48be as yu,s8 as wu,seq as Vr,struct as Tu,Structure as Wr,u16 as Pu,u16be as xu,u24 as Au,u24be as Su,u32 as Lu,u32be as Bu,u40 as Cu,u40be as ku,u48 as Nu,u48be as Iu,u8 as Eu,UInt as Ur,union as Mu,Union as Du,unionLayoutDiscriminator as Ru,utf8 as Ou}from"@solana/buffer-layout";var bt=Kr,an=Wr;var un=Ur;var cn=Vr;var he=vr;var yt=class extends bt{constructor(n,r,i){super(n,i);this.blob=he(n),this.signed=r}decode(n,r=0){let i=new ln(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new ln(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function be(e){return new un(1,e)}function ee(e){return new yt(8,!1,e)}var wt=class extends bt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function me(e){return new wt(he(32),t=>new qr(t),t=>t.toBuffer(),e)}var Tt=class extends an{decode(t,n){return super.decode(t,n)}};function ye(e,t,n){return new Tt(e,t,n)}function Ie(e,t,n){let r,i=typeof t=="number"?t:fn(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=fn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return cn(e,i,n)}var Pt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Ee=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=Y(n)}createTxBuilder(t){return this.scope.checkOwner(),new Qe({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Pt(t))}logInfo(...t){this.logger.info(Pt(t))}logAndCreateError(...t){let n=Pt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var H=class extends Ee{static getPdaPoolId(t,n){return Ye([H.SEED_CONFIG.pool.id,n.toBuffer()],t)}static getPdaOwnerId(t,n,r,i){return Ye([H.SEED_CONFIG.owner.id,n.toBuffer(),r.toBuffer(),Buffer.from(new mn(i).toArray())],t)}static async getAllInfo({connection:t,programId:n,poolIds:r,wallet:i,chainTime:o}){if(r.length===0)return[];let s=r.map(l=>H.getPdaPoolId(n,l).publicKey),a=[];for(let l=0;l<H.VERSION_PROJECT.length;l++)a.push(...s.map(f=>H.getPdaOwnerId(n,f,i,l).publicKey));let c=await Re(t,[...s,...a]),u=[];for(let l=0;l<c.length;l++){let f=Math.floor(l/r.length),m=l%r.length,d=s[m],h=a[l],g=c[m],b=c[r.length+l];if(!(g&&b)||g.data.length!==H.POOL_LAYOUT.span||b.data.length!==H.OWNER_LAYOUT.span)continue;let T=H.POOL_LAYOUT.decode(g.data),x=H.OWNER_LAYOUT.decode(b.data),w=T.openTime.toNumber(),y=T.endTime.toNumber(),S=x.tokenInfo.map(B=>B.debtAmount.gt(new mn(0))).filter(B=>!B).length!==3,P=o>w&&o<y&&T.status===1,N=S&&P;u.push({programId:n,poolId:d,ammId:T.ammId,ownerAccountId:h,snapshotLpAmount:x.lpAmount,project:H.VERSION_PROJECT[f],openTime:w,endTime:y,canClaim:N,canClaimErrorType:S?P?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:T.tokenInfo.map((B,D)=>({mintAddress:B.mintAddress,mintVault:B.mintVault,mintDecimals:B.mintDecimals,perLpLoss:B.perLpLoss,debtAmount:x.tokenInfo[D].debtAmount.add(x.tokenInfo[D].claimedAmount)}))})}return u}async makeClaimTransaction({poolInfo:t,ownerInfo:n}){n.wallet||this.scope.checkOwner();let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o=[];for(let c of t.tokenInfo){let{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:c.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:c.mintAddress.equals(J.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!c.mintAddress.equals(J.WSOL.mint),associatedOnly:c.mintAddress.equals(J.WSOL.mint)?!1:n.associatedOnly});l&&r.addInstruction(l),o.push(u)}r.addInstruction({instructions:[H.makeClaimInstruction({programId:t.programId,poolInfo:t,ownerInfo:{wallet:i,ownerPda:t.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=r.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:t,ownerInfo:n}){let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o={};for(let u of t){let l=[];for(let f of u.tokenInfo){let{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({mint:f.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:f.mintAddress.equals(J.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!f.mintAddress.equals(J.WSOL.mint),associatedOnly:f.mintAddress.equals(J.WSOL.mint)?!1:n.associatedOnly});d&&r.addInstruction(d),m&&(o[f.mintAddress.toString()]=m,l.push(m))}r.addInstruction({instructions:[H.makeClaimInstruction({programId:u.programId,poolInfo:u,ownerInfo:{wallet:i,ownerPda:u.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=r.build(),c=r.allInstructions;return dt(c,[i,...a.map(u=>u.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new xt().add(...c.slice(0,r.AllTxData.instructions.length-1)),signer:a},{transaction:new xt().add(...c.slice(r.AllTxData.instructions.length-1)),signer:[]},{transaction:new xt().add(...r.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:t,poolInfo:n,ownerInfo:r}){let i=ye([]),o=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:n.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(c=>({pubkey:c,isSigner:!1,isWritable:!0})),...n.tokenInfo.map(({mintVault:c})=>({pubkey:c,isSigner:!1,isWritable:!0})),{pubkey:jr,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new Hr({keys:o,programId:t,data:a})}},te=H;te.CLAIMED_NUM=3,te.POOL_LAYOUT=ye([he(8),be("bump"),be("status"),ee("openTime"),ee("endTime"),me("ammId"),Ie(ye([be("mintDecimals"),me("mintAddress"),me("mintVault"),ee("perLpLoss"),ee("totalClaimedAmount")]),H.CLAIMED_NUM,"tokenInfo"),Ie(ee(),10,"padding")]),te.OWNER_LAYOUT=ye([he(8),be("bump"),be("version"),me("poolId"),me("owner"),ee("lpAmount"),Ie(ye([me("mintAddress"),ee("debtAmount"),ee("claimedAmount")]),H.CLAIMED_NUM,"tokenInfo"),Ie(ee(),4,"padding")]),te.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(t=>new Gr(t)),te.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},te.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];export{te as default};
//# sourceMappingURL=index.mjs.map